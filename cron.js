const cron = require('node-cron');
const scannerOps = require('./scanner_operations');
const models = require("./schemas_and_models");

//Sync server status every 30 seconds.
cron.schedule('*/30 * * * * *', function () {
    models.Scanner.find({}, async function(err, scanners) {

        if (err) {
            console.log(err);
        }

        for (let i = 0; i < scanners.length; i++) {
            let scannerStatus = {};

            scannerStatus = await scannerOps.getStatus(scanners[i]);

            models.Scanner.updateOne({_id: scanners[i]._id}, {status: scannerStatus.status}, function(err, results) {
                if (err) {
                    console.log(err);
                }
            });
        }
    });
});

module.exports = {
    cron
}